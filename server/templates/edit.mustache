<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        {{> bulma.css}}
    </style>
    <style>
        nav {
            margin-top: 1em;
            margin-bottom: 1em;
        }

        textarea, input[name="slug"], form, form button {
            font-size: 1em;
            font-family: "SF Mono", "Menlo-Regular", Consolas, "Andale Mono WT",
            "Andale Mono", "Lucida Console", "Lucida Sans Typewriter",
            "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Liberation Mono",
            "Nimbus Mono L", Monaco, "Courier New", Courier, monospace;
        }

        iframe {
            min-height: 40vh;
            border: 1px solid gray;
        }
    </style>
</head>
<body class="container is-fluid" style="margin-top: 1em; margin-bottom: 80px">
    <nav style="display: flex; justify-content: space-between;">
        <a href="/backstage" class="button">&larr; backstage</a>
        <a href="/{{post.id}}.html" target="_blank" class="button">{{post.id}}</a>
    </nav>
    <form method="POST">
        <input type="hidden" name="id" value="{{post.id}}">
        <input
            name="slug"
            pattern="[a-zA-Z0-9_-]+"
            value="{{post.slug}}"
            placeholder="slug"
            class="field input"
        >
        <textarea
            name="text"
            placeholder="markdown text"
            class="field textarea"
            rows="8"
        >{{{post.text}}}</textarea>
        <div class="field is-horizontal" style="justify-content: space-between;">
            <div class="field has-addons">
                <div class="control">
                    <button type="submit"
                        formtarget="preview"
                        formaction="/backstage/preview/"
                        class="button"
                    >
                        preview
                    </button>
                </div>
                <div class="control">
                    <button type="submit"
                        formtarget="preview"
                        formaction="/backstage/media/"
                        formmethod="GET" 
                        class="button"
                    >
                        media
                    </button>
                </div>
            </div>
            <div class="field has-addons">
                <div class="control">
                    <input
                        type="datetime-local"
                        name="created"
                        value="{{post.created}}"
                        class="input"
                        pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}"
                    />
                </div>
            </div>
            {{#post}}
                <div class="field has-addons">
                    <div class="control">
                        <button type="submit"
                            name="draft"
                            value="1"
                            class="button"
                        >
                            {{#draft}}draft{{/draft}}
                            {{^draft}}
                                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 576 512"><path fill="currentColor" d="M286.693 391.984l32.579 46.542A333.958 333.958 0 0 1 288 440C168.19 440 63.031 376.051 6.646 280.369a47.999 47.999 0 0 1 0-48.739c24.023-40.766 56.913-75.775 96.024-102.537l57.077 81.539C154.736 224.82 152 240.087 152 256c0 74.736 60.135 135.282 134.693 135.984zm282.661-111.615c-31.667 53.737-78.747 97.46-135.175 125.475l.011.015 41.47 59.2c7.6 10.86 4.96 25.82-5.9 33.42l-13.11 9.18c-10.86 7.6-25.82 4.96-33.42-5.9L100.34 46.94c-7.6-10.86-4.96-25.82 5.9-33.42l13.11-9.18c10.86-7.6 25.82-4.96 33.42 5.9l51.038 72.617C230.68 75.776 258.905 72 288 72c119.81 0 224.969 63.949 281.354 159.631a48.002 48.002 0 0 1 0 48.738zM424 256c0-75.174-60.838-136-136-136-17.939 0-35.056 3.473-50.729 9.772l19.299 27.058c25.869-8.171 55.044-6.163 80.4 7.41h-.03c-23.65 0-42.82 19.17-42.82 42.82 0 23.626 19.147 42.82 42.82 42.82 23.65 0 42.82-19.17 42.82-42.82v-.03c18.462 34.49 16.312 77.914-8.25 110.95v.01l19.314 27.061C411.496 321.2 424 290.074 424 256zM262.014 356.727l-77.53-110.757c-5.014 52.387 29.314 98.354 77.53 110.757z"></path></svg>
                            {{/draft}}
                        </button>
                    </div>
                    <div class="control">
                        <button type="submit"
                            name="private"
                            value="1"
                            class="control button"
                        >
                            {{#private}}private{{/private}}
                            {{^private}}
                                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 512 512"><path fill="currentColor" d="M496 128c0 221.282-135.934 344.645-221.539 380.308a48 48 0 0 1-36.923 0C130.495 463.713 16 326.487 16 128a48 48 0 0 1 29.539-44.308l192-80a48 48 0 0 1 36.923 0l192 80A48 48 0 0 1 496 128zM256 446.313l.066.034c93.735-46.689 172.497-156.308 175.817-307.729L256 65.333v380.98z"></path></svg>
                            {{/private}}
                        </button>
                    </div>
                    <div class="control">
                        <button type="submit"
                            name="public"
                            value="1"
                            class="control button"
                        >
                            {{#public}}public{{/public}}
                            {{^public}}
                                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 576 512"><path fill="currentColor" d="M552 64H88c-13.255 0-24 10.745-24 24v8H24c-13.255 0-24 10.745-24 24v272c0 30.928 25.072 56 56 56h472c26.51 0 48-21.49 48-48V88c0-13.255-10.745-24-24-24zM56 400a8 8 0 0 1-8-8V144h16v248a8 8 0 0 1-8 8zm236-16H140c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm208 0H348c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm-208-96H140c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm208 0H348c-6.627 0-12-5.373-12-12v-8c0-6.627 5.373-12 12-12h152c6.627 0 12 5.373 12 12v8c0 6.627-5.373 12-12 12zm0-96H140c-6.627 0-12-5.373-12-12v-40c0-6.627 5.373-12 12-12h360c6.627 0 12 5.373 12 12v40c0 6.627-5.373 12-12 12z"></path></svg>
                            {{/public}}
                        </button>
                    </div>
                </div>
                {{#draft}}
                    <div class="field has-addons">
                        <button type="submit"
                            formaction="/backstage/delete/"
                            class="button"
                            onclick="return confirm('delete {{id}}?')" 
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 448 512"><path fill="currentColor" d="M0 84V56c0-13.3 10.7-24 24-24h112l9.4-18.7c4-8.2 12.3-13.3 21.4-13.3h114.3c9.1 0 17.4 5.1 21.5 13.3L312 32h112c13.3 0 24 10.7 24 24v28c0 6.6-5.4 12-12 12H12C5.4 96 0 90.6 0 84zm415.2 56.7L394.8 467c-1.6 25.3-22.6 45-47.9 45H101.1c-25.3 0-46.3-19.7-47.9-45L32.8 140.7c-.4-6.9 5.1-12.7 12-12.7h358.5c6.8 0 12.3 5.8 11.9 12.7z"></path></svg>
                        </button>
                    </div>
                {{/draft}}
            {{/post}}
        </div>
    </form>
    <iframe name="preview"
        width="100%"
        frameborder="0"
    ></iframe>
    <script>
        /* eslint-env browser */
        window.appendText = function (text) {
            const textarea = document.querySelector('textarea[name="text"]')
            textarea.innerText = (textarea.innerText + ' ' + text.trim()).trim()

            textarea.focus()
            textarea.selectionStart = textarea.innerText.length
            textarea.selectionEnd = textarea.innerText.length
        }
    </script>
</body>
</html>
